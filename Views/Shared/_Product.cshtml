@using EPiServer.Core
@using EPiServer.Web.Mvc.Html

@model EPiServer.Commerce.Models.ViewModels.Contracts.IProductModel

@{
    bool hasDiscount = Model.ExtendedPrice < Model.PlacedPrice;
    string productLevelClass = hasDiscount ? "product has-discount" : "product";
    bool renderWishListButtons = User.Identity.IsAuthenticated; 
}

<div class="@productLevelClass">
    <a href="@Model.Url" class="link--black">
        <img src="@Model.ImageUrl" alt="@Model.DisplayName" class="img-responsive" />
        <h3 class="product-title">@Html.DisplayFor(x=>x.DisplayName)</h3>
        <span class="product-brand">@Html.DisplayFor(x => x.Brand)</span>
        @if (hasDiscount)
        {
            <h4 class="product-price">@Html.PropertyFor(x=>x.PlacedPrice, new {tag="StyleMoney"})</h4> 
            <h4 class="product-price product-price--discount">@Html.PropertyFor(x=>x.ExtendedPrice, new {tag="StyleMoney"})</h4>
        }
        else { 
            <h4 class="product-price">@Html.PropertyFor(x=>x.ExtendedPrice, new {tag="StyleMoney"})</h4> 
        }
    </a>

    @if (renderWishListButtons)
    {
        <div class="action-buttons wishlist-actions">
            @using (@Html.BeginForm("AddToCart", "Cart", FormMethod.Post, new { @class = "form-inline", data_container = "MiniCart" }))
            {
                @Html.Hidden("code", Model.Code)
                <button type="submit" role="button" class="btn btn-primary jsAddToCart"><span class="glyphicon glyphicon-shopping-cart"></span>Add To Cart</button>
            }
            @using (@Html.BeginForm("ChangeCartItem", "WishList", FormMethod.Post, new { @class = "form-inline", data_container = "WishListMiniCart" }))
            {
                @Html.Hidden("code", Model.Code)
                @Html.Hidden("quantity", 0, new { @class = "jsChangeCartItem" })
                <button role="button" class="btn btn-gray-lighter jsRemoveCartItem"><i class="glyphicon glyphicon-remove"></i></button>
            }
        </div>
    }
</div>
<div class="quick-view-btn-container">
    <button type="button" data-toggle="modal" data-target="#Quickview" data-url="@Model.Url" class="btn btn-block btn-sm quickview-button">@Html.Translate("/Product/Quickview")</button>
</div>
